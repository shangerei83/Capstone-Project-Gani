<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/base}">
<head>
    <title>Shopping Cart - GaniMart</title>
</head>
<body>
    <div layout:fragment="content">
        <section class="panel stack">
            <!-- Page Header -->
            <div class="card">
                <h1>Shopping Cart</h1>
                <p class="muted" th:text="${'You have ' + cartItems.size() + ' item(s) in your cart'}">You have 0 item(s) in your cart</p>
            </div>

            <!-- Empty Cart Message -->
            <div th:if="${cartItems == null or cartItems.isEmpty()}" class="card center" style="height: 300px;">
                <div>
                    <h3>Your cart is empty</h3>
                    <p class="muted">Start shopping to add items to your cart</p>
                    <a th:href="@{/catalog}" class="btn btn-primary">Browse Products</a>
                </div>
            </div>

            <!-- Cart Items -->
            <div th:if="${cartItems != null and !cartItems.isEmpty()}" class="split">
                <!-- Cart Items List -->
                <div class="stack">
                    <div th:each="item : ${cartItems}" th:object="${item}" class="card">
                        <div class="row">
                            <img th:src="${item.imageUrl}" th:alt="${item.title}"
                                 style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;" />
                            
                            <div style="flex: 1;">
                                <h4 th:text="${item.title}">Product Title</h4>
                                <p class="muted" th:text="${item.categoryName != null ? item.categoryName : 'Category'}">Category</p>
                                <div class="row" style="justify-content: space-between; align-items: center;">
                                    <span class="price" th:text="${'$' + #numbers.formatDecimal(item.unitPrice, 1, 2)}">$0.00</span>
                                    <div class="row" style="gap: 8px; align-items: center;">
                                        <label for="quantity" style="margin: 0;">Qty:</label>
                                        <form th:action="@{/cart/update-quantity}" method="post" class="row" style="gap:8px; align-items:center;">
                                            <input type="hidden" name="itemId" th:value="${item.id}" />
                                            <select id="quantity" name="quantity" th:value="${item.quantity}" style="width: 60px;" onchange="this.form.submit()">
                                                <option th:each="q : ${#numbers.sequence(1, 10)}" th:value="${q}"
                                                        th:text="${q}" th:selected="${q == item.quantity}">1</option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 8px; justify-content: space-between; align-items: center;">
                                    <span class="muted" th:text="${'Subtotal: $' + #numbers.formatDecimal(item.subtotal, 1, 2)}">Subtotal: $0.00</span>
                                    <form th:action="@{/cart/remove}" method="post" style="display: inline;">
                                        <input type="hidden" name="itemId" th:value="${item.id}" />
                                        <button type="submit" class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;">Remove</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cart Summary -->
                <div class="card" style="height: fit-content;">
                    <h3>Order Summary</h3>
                    
                    <div class="stack" style="margin: 16px 0;">
                        <div class="row" style="justify-content: space-between;">
                            <span>Subtotal:</span>
                            <span th:text="${'$' + #numbers.formatDecimal(cartSummary.subtotal, 1, 2)}">$0.00</span>
                        </div>
                        <div class="row" style="justify-content: space-between;">
                            <span>Shipping:</span>
                            <span th:text="${'$' + #numbers.formatDecimal(cartSummary.shipping, 1, 2)}">$0.00</span>
                        </div>
                        <div class="row" style="justify-content: space-between;">
                            <span>Tax:</span>
                            <span th:text="${'$' + #numbers.formatDecimal(cartSummary.tax, 1, 2)}">$0.00</span>
                        </div>
                        
                        <hr style="border: none; border-top: 1px solid var(--border); margin: 16px 0;">
                        
                        <div class="row" style="justify-content: space-between; font-weight: 600; font-size: 18px;">
                            <span>Total:</span>
                            <span class="price" th:text="${'$' + #numbers.formatDecimal(cartSummary.total, 1, 2)}">$0.00</span>
                        </div>
                    </div>
                    
                    <div class="stack">
                        <a th:href="@{/checkout}" class="btn btn-primary" style="width: 100%;">
                            Proceed to Checkout
                        </a>
                        
                        <a th:href="@{/catalog}" class="btn btn-ghost" style="width: 100%;">
                            Continue Shopping
                        </a>
                    </div>
                    
                    <!-- Promo Code -->
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                        <h4 style="margin: 0 0 8px 0;">Have a promo code?</h4>
                        <form th:action="@{/cart/apply-promo}" method="post" class="form">
                            <div class="row">
                                <input type="text" name="promoCode" placeholder="Enter promo code" style="flex: 1;" />
                                <button type="submit" class="btn btn-ghost">Apply</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Recently Viewed Products -->
            <div th:if="${recentlyViewed != null and !recentlyViewed.isEmpty()}" class="stack">
                <h3>Recently Viewed</h3>
                <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div th:each="product : ${recentlyViewed}" th:object="${product}" class="card product-card">
                        <img th:src="${product.imageUrl}" th:alt="${product.title}" referrerpolicy="no-referrer" />
                        <h4 th:text="${product.title}">Product Title</h4>
                        <div class="row" style="justify-content:space-between;align-items:center;">
                            <span class="price" th:text="${'$' + #numbers.formatDecimal(product.price, 1, 2)}">$0.00</span>
                            <span class="rating">★★★★★</span>
                        </div>
                        <div class="row" style="margin-top:8px;">
                            <a class="btn" th:href="@{/product/{id}(id=${product.id})}">View</a>
                            <form th:action="@{/cart/add}" method="post" style="display: inline;">
                                <input type="hidden" name="productId" th:value="${product.id}" />
                                <input type="hidden" name="quantity" value="1" />
                                <button type="submit" class="btn btn-primary">Add</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
